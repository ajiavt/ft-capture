<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>FT Capture Settings</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #007AFF;
            color: white;
            padding: 20px;
            text-align: center;
        }
        .content {
            padding: 20px;
        }
        .section {
            margin-bottom: 30px;
        }
        .section h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007AFF;
            padding-bottom: 10px;
        }
        .area-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-bottom: 10px;
            background: #fafafa;
        }
        .area-info {
            flex: 1;
        }
        .area-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .area-coords {
            font-size: 12px;
            color: #666;
        }
        .hotkey-input {
            width: 120px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 0 10px;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 0 5px;
        }
        .btn-primary {
            background: #007AFF;
            color: white;
        }
        .btn-danger {
            background: #FF3B30;
            color: white;
        }
        .btn-success {
            background: #34C759;
            color: white;
        }
        .btn:hover {
            opacity: 0.8;
        }
        .add-area-btn {
            width: 100%;
            padding: 15px;
            background: #34C759;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
        }
        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }
        .save-path-input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 10px;
        }
        .instructions {
            background: #E3F2FD;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        .instructions h4 {
            margin-top: 0;
            color: #1976D2;
        }
        .instructions ul {
            margin: 10px 0;
            padding-left: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>FT Capture Settings</h2>
        </div>

        <div class="content">
            <div class="instructions">
                <h4>Quick Start Instructions:</h4>
                <ul>
                    <li><strong>Cmd/Ctrl + Shift + A</strong>: Start area selection</li>
                    <li>Click "Add New Area" or use hotkey to define screenshot areas</li>
                    <li>Assign custom hotkeys to each area</li>
                    <li>Screenshots are automatically copied to clipboard</li>
                </ul>
            </div>

            <div class="section">
                <h3>Screenshot Areas</h3>
                <button class="add-area-btn" onclick="startAreaSelection()">
                    ðŸ“· Add New Area (Cmd/Ctrl + Shift + A)
                </button>
                <div id="areas-list">
                    <!-- Areas will be populated here -->
                </div>
            </div>

            <div class="section">
                <h3>General Settings</h3>
                <div class="settings-item">
                    <label>Save Path (optional):</label>
                    <div style="display: flex; flex: 1; margin-left: 20px;">
                        <input type="text" id="save-path" class="save-path-input" placeholder="Default: Desktop">
                        <button class="btn btn-primary" onclick="browseSavePath()">Browse</button>
                    </div>
                </div>
                <div class="settings-item">
                    <label>Save to file (in addition to clipboard):</label>
                    <input type="checkbox" id="auto-save" onchange="toggleAutoSave()">
                </div>
            </div>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');
        const Store = require('electron-store');
        const store = new Store();

        // Load settings on startup
        document.addEventListener('DOMContentLoaded', () => {
            loadAreas();
            loadSettings();
        });

        function loadAreas() {
            const areas = store.get('areas', []);
            const areasList = document.getElementById('areas-list');

            if (areas.length === 0) {
                areasList.innerHTML = '<p style="text-align: center; color: #666;">No areas defined yet. Click "Add New Area" to get started.</p>';
                return;
            }

            areasList.innerHTML = areas.map(area => `
                <div class="area-item">
                    <div class="area-info">
                        <div class="area-name">${area.name}</div>
                        <div class="area-coords">
                            Position: ${area.x}, ${area.y} | Size: ${area.width} Ã— ${area.height}
                        </div>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <label>Hotkey:</label>
                        <input type="text" class="hotkey-input"
                               value="${getHotkeyForArea(area.id)}"
                               onchange="setAreaHotkey('${area.id}', this.value)"
                               placeholder="e.g. Ctrl+1">
                        <button class="btn btn-primary" onclick="testCapture('${area.id}')">Test</button>
                        <button class="btn btn-danger" onclick="removeArea('${area.id}')">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function loadSettings() {
            const savePath = store.get('savePath', '');
            const autoSave = store.get('autoSave', false);

            document.getElementById('save-path').value = savePath;
            document.getElementById('auto-save').checked = autoSave;
        }

        function getHotkeyForArea(areaId) {
            const hotkeys = store.get('hotkeys', {});
            const hotkey = Object.keys(hotkeys).find(key => hotkeys[key] === areaId);
            return hotkey || '';
        }

        function setAreaHotkey(areaId, hotkey) {
            if (!hotkey.trim()) return;

            const hotkeys = store.get('hotkeys', {});

            // Remove old hotkey for this area
            Object.keys(hotkeys).forEach(key => {
                if (hotkeys[key] === areaId) {
                    delete hotkeys[key];
                }
            });

            // Set new hotkey
            hotkeys[hotkey] = areaId;
            store.set('hotkeys', hotkeys);

            // Notify main process to re-register hotkeys
            ipcRenderer.send('refresh-hotkeys');
        }

        function removeArea(areaId) {
            if (confirm('Are you sure you want to delete this area?')) {
                let areas = store.get('areas', []);
                areas = areas.filter(a => a.id !== areaId);
                store.set('areas', areas);

                // Remove associated hotkey
                const hotkeys = store.get('hotkeys', {});
                Object.keys(hotkeys).forEach(key => {
                    if (hotkeys[key] === areaId) {
                        delete hotkeys[key];
                    }
                });
                store.set('hotkeys', hotkeys);

                loadAreas();
                ipcRenderer.send('refresh-hotkeys');
            }
        }

        function testCapture(areaId) {
            ipcRenderer.send('test-capture', areaId);
        }

        function startAreaSelection() {
            ipcRenderer.send('start-area-selection');
            window.close(); // Close settings during selection
        }

        function browseSavePath() {
            const { dialog } = require('electron').remote || require('@electron/remote');
            const result = dialog.showOpenDialogSync({
                properties: ['openDirectory']
            });

            if (result && result[0]) {
                document.getElementById('save-path').value = result[0];
                store.set('savePath', result[0]);
            }
        }

        function toggleAutoSave() {
            const autoSave = document.getElementById('auto-save').checked;
            store.set('autoSave', autoSave);
        }

        // Listen for area selection completion
        ipcRenderer.on('area-selected', (event, area) => {
            loadAreas();
        });
    </script>
</body>
</html>

