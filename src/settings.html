<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>FT Capture Settings</title>
    <!-- Font Awesome Icons - Local -->
    <link rel="stylesheet" href="../assets/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            overflow: hidden;
        }

        .app-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            flex-shrink: 0;
            -webkit-app-region: drag;
            cursor: move;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            pointer-events: none;
        }

        .app-icon {
            width: 48px;
            height: 48px;
            background: #fff;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            color: #00b894;
            pointer-events: none;
        }

        .app-title {
            font-size: 28px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .app-subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 4px;
        }

        .main-content {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .sidebar {
            width: 50%;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(0,0,0,0.1);
            padding: 32px;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .content-area {
            width: 50%;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(20px);
            padding: 32px;
            overflow-y: auto;
        }

        .section {
            margin-bottom: 20px;
        }

        .section h3 {
            color: #00a085;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .macro-item {
            display: flex;
            flex-direction: column;
            padding: 15px;
            border: 1px solid #dfe6e9;
            border-radius: 12px;
            margin-bottom: 12px;
            margin-top: 2px;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            transition: all 0.3s ease;
        }

        .macro-item:hover {
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            border-color: #00b894;
            transform: translateY(-2px);
        }

        .macro-info {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .macro-color-indicator {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            border: 2px solid rgba(255,255,255,0.8);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            flex-shrink: 0;
        }

        .macro-details {
            flex: 1;
        }

        .macro-name {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 6px;
            color: #333;
        }

        .macro-hotkey {
            font-size: 13px;
            color: #666;
            background: #f5f5f5;
            padding: 6px 12px;
            border-radius: 6px;
            display: inline-block;
            margin-bottom: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-weight: 500;
        }

        .macro-area {
            font-size: 12px;
            color: #888;
        }

        .area-assigned {
            color: #00b894;
            font-weight: 600;
        }

        .area-pending {
            color: #81ecec;
            font-weight: 600;
        }

        .macro-actions {
            display: flex;
            gap: 6px;
            justify-content: flex-start;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            min-width: 90px;
            justify-content: center;
            flex: 1;
            max-width: 110px;
        }

        .btn-primary {
            background: #00b894;
            color: white;
            box-shadow: 0 2px 8px rgba(0, 184, 148, 0.3);
        }

        .btn-primary:hover {
            background: #00a085;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 184, 148, 0.4);
        }

        .btn-secondary {
            background: #00cec9;
            color: white;
            box-shadow: 0 2px 8px rgba(0, 206, 201, 0.3);
        }

        .btn-secondary:hover {
            background: #00b7b3;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 206, 201, 0.4);
        }

        .btn-warning {
            background: #81ecec;
            color: #333;
            box-shadow: 0 2px 8px rgba(129, 236, 236, 0.3);
        }

        .btn-warning:hover {
            background: #6bc5c5;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(129, 236, 236, 0.4);
        }

        .btn-danger {
            background: #dfe6e9;
            color: #333;
            box-shadow: 0 2px 8px rgba(223, 230, 233, 0.3);
        }

        .btn-danger:hover {
            background: #c8d4da;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(223, 230, 233, 0.4);
        }

        .btn-ghost {
            background: rgba(255,255,255,0.9);
            color: #666;
            border: 2px solid #dfe6e9;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .btn-ghost:hover {
            background: white;
            border-color: #00b894;
            color: #00b894;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .add-macro-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 3px 12px rgba(0, 184, 148, 0.3);
        }

        .add-macro-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(0, 184, 148, 0.4);
        }

        .settings-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            margin-bottom: 20px;
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #dfe6e9;
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-label {
            font-weight: 600;
            font-size: 16px;
            color: #333;
        }

        .save-path-input {
            flex: 1;
            padding: 10px 12px;
            border: 2px solid #dfe6e9;
            border-radius: 6px;
            margin-right: 10px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .save-path-input:focus {
            outline: none;
            border-color: #00b894;
            box-shadow: 0 0 0 3px rgba(0, 184, 148, 0.1);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 16px;
            width: 500px;
            max-width: 90vw;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal h3 {
            color: #00a085;
            margin-bottom: 20px;
            text-align: center;
            font-size: 22px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #dfe6e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #00b894;
            box-shadow: 0 0 0 3px rgba(0, 184, 148, 0.1);
        }

        .color-group {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .color-picker {
            width: 60px;
            height: 50px;
            border: 2px solid #dfe6e9;
            border-radius: 8px;
            cursor: pointer;
            background: none;
        }

        .color-presets {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .color-preset {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s ease;
        }

        .color-preset:hover {
            transform: scale(1.1);
            border-color: rgba(255,255,255,0.8);
        }

        .color-preset.selected {
            border-color: #333;
            box-shadow: 0 0 0 2px rgba(0, 184, 148, 0.3);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .hotkey-input {
            background: #f8f9fa !important;
            font-family: 'Monaco', 'Menlo', monospace;
            cursor: pointer;
        }

        .hotkey-input.listening {
            background: #e3f8f6 !important;
            border-color: #00cec9 !important;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
            color: #00b894;
        }

        .scrollable {
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }

        .scrollable::-webkit-scrollbar {
            width: 6px;
        }

        .scrollable::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .scrollable::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        .scrollable::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 20px;
            background: #f8fffe;
            border-radius: 12px;
            border: 1px solid rgba(0, 184, 148, 0.1);
        }

        .theme-sample {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: #f8fffe;
            border-radius: 8px;
            border: 1px solid rgba(0, 184, 148, 0.1);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <div class="header-content">
                <div class="app-icon"><i class="fas fa-camera"></i></div>
                <div>
                    <div class="app-title">FT Capture</div>
                    <div class="app-subtitle">Professional Screenshot Tool</div>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="content-area">
                <div class="section">
                    <h3><i class="fas fa-cog"></i> General Settings</h3>
                    <div class="settings-card">
                        <div class="settings-item">
                            <span class="settings-label">Save Path:</span>
                            <div style="display: flex; flex: 1; margin-left: 20px;">
                                <input type="text" id="save-path" class="save-path-input" placeholder="Default: Desktop">
                                <button class="btn btn-secondary" onclick="browseSavePath()"><i class="fas fa-folder"></i> Browse</button>
                            </div>
                        </div>
                        <div class="settings-item">
                            <span class="settings-label">Auto-save to file:</span>
                            <input type="checkbox" id="auto-save" onchange="toggleAutoSave()">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3><i class="fas fa-chart-bar"></i> Statistics</h3>
                    <div class="settings-card">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div style="font-size: 32px; font-weight: 700; color: #00b894;" id="total-macros">0</div>
                                <div style="font-size: 14px; color: #666; margin-top: 8px;">Total Macros</div>
                            </div>
                            <div class="stat-item">
                                <div style="font-size: 32px; font-weight: 700; color: #00cec9;" id="ready-macros">0</div>
                                <div style="font-size: 14px; color: #666; margin-top: 8px;">Ready to Use</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3><i class="fas fa-info-circle"></i> How to Use</h3>
                    <div class="settings-card">
                        <ol style="padding-left: 20px; line-height: 2; font-size: 15px;">
                            <li><strong>Add New Macro</strong> - Create a macro with name, hotkey, and color theme</li>
                            <li><strong>Assign Area</strong> - Click "Set Area" to visually select screenshot region</li>
                            <li><strong>Use Macro</strong> - Press your hotkey to capture and copy to clipboard</li>
                            <li><strong>Paste</strong> - Use Ctrl+V in Word or any application</li>
                            <li><strong>Edit Macro</strong> - Click edit button to change name, hotkey, or color</li>
                        </ol>
                    </div>
                </div>

                <div class="section">
                    <h3><i class="fas fa-palette"></i> Color Themes</h3>
                    <div class="settings-card">
                        <p style="margin-bottom: 20px; color: #666; font-size: 15px; line-height: 1.6;">
                            Choose different colors for your macros to easily identify them. Each macro can have its own unique color theme that will be reflected in notifications and indicators.
                        </p>
                        <div class="color-themes" style="display: flex; gap: 12px; flex-wrap: wrap;">
                            <div class="theme-sample">
                                <div style="width: 20px; height: 20px; background: #00b894; border-radius: 4px;"></div>
                                <span style="font-size: 14px; color: #666;">Primary</span>
                            </div>
                            <div class="theme-sample">
                                <div style="width: 20px; height: 20px; background: #00cec9; border-radius: 4px;"></div>
                                <span style="font-size: 14px; color: #666;">Secondary</span>
                            </div>
                            <div class="theme-sample">
                                <div style="width: 20px; height: 20px; background: #81ecec; border-radius: 4px;"></div>
                                <span style="font-size: 14px; color: #666;">Light</span>
                            </div>
                            <div class="theme-sample">
                                <div style="width: 20px; height: 20px; background: #dfe6e9; border-radius: 4px;"></div>
                                <span style="font-size: 14px; color: #666;">Neutral</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <button class="add-macro-btn" onclick="showAddMacroModal()">
                    <i class="fas fa-plus"></i> Add New Macro
                </button>

                <div class="section">
                    <h3><i class="fas fa-list"></i> Your Macros</h3>
                    <div id="macros-list" class="scrollable">
                        <!-- Macros will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Macro Modal -->
    <div id="macroModal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title">Add New Macro</h3>
            <div class="form-group">
                <label for="macro-name">Macro Name:</label>
                <input type="text" id="macro-name" placeholder="e.g. Top Left Area">
            </div>
            <div class="form-group">
                <label for="macro-hotkey">Hotkey:</label>
                <input type="text" id="macro-hotkey" class="hotkey-input" placeholder="Click here and press your key combination..." readonly>
                <small style="color: #666; display: block; margin-top: 5px;">
                    Examples: Cmd+1, Ctrl+Shift+A, Alt+F1, etc.
                </small>
            </div>
            <div class="form-group">
                <label for="macro-color">Color Theme:</label>
                <div class="color-group">
                    <input type="color" id="macro-color" class="color-picker" value="#4CAF50">
                    <div class="color-presets">
                        <div class="color-preset" data-color="#4CAF50" style="background: #4CAF50;"></div>
                        <div class="color-preset" data-color="#2196F3" style="background: #2196F3;"></div>
                        <div class="color-preset" data-color="#FF9800" style="background: #FF9800;"></div>
                        <div class="color-preset" data-color="#9C27B0" style="background: #9C27B0;"></div>
                        <div class="color-preset" data-color="#F44336" style="background: #F44336;"></div>
                        <div class="color-preset" data-color="#795548" style="background: #795548;"></div>
                    </div>
                </div>
                <small style="color: #666; display: block; margin-top: 5px;">
                    Choose a color for the notification theme
                </small>
            </div>
            <div class="modal-actions">
                <button class="btn btn-ghost" onclick="hideMacroModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveMacro()" id="save-macro-btn" disabled>Save Macro</button>
            </div>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');
        const Store = require('electron-store');
        const store = new Store();

        let currentEditingMacro = null;
        let detectingHotkey = false;

        document.addEventListener('DOMContentLoaded', () => {
            loadMacros();
            loadSettings();
            setupColorPresets();
        });

        function loadMacros() {
            const macros = store.get('macros', []);
            const macrosList = document.getElementById('macros-list');

            // Update statistics
            updateStatistics(macros);

            if (macros.length === 0) {
                macrosList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">📷</div>
                        <p>No macros created yet.<br>Click "Add New Macro" to get started.</p>
                    </div>
                `;
                return;
            }

            macrosList.innerHTML = macros.map(macro => `
                <div class="macro-item">
                    <div class="macro-info">
                        <div class="macro-color-indicator" style="background: ${macro.color || '#00b894'};"></div>
                        <div class="macro-details">
                            <div class="macro-name">${macro.name}</div>
                            <div class="macro-hotkey">${macro.hotkey}</div>
                            <div class="macro-area ${macro.area ? 'area-assigned' : 'area-pending'}">
                                ${macro.area ?
                                    `Area: ${macro.area.x}, ${macro.area.y} (${macro.area.width} × ${macro.area.height})` :
                                    'No area assigned'
                                }
                            </div>
                        </div>
                    </div>
                    <div class="macro-actions">
                        <button class="btn btn-ghost" onclick="editMacro('${macro.id}')"><i class="fas fa-edit"></i> Edit</button>
                        ${macro.area ?
                            `<button class="btn btn-warning" onclick="setMacroArea('${macro.id}')"><i class="fas fa-sync-alt"></i> Change</button>` :
                            `<button class="btn btn-primary" onclick="setMacroArea('${macro.id}')"><i class="fas fa-crosshairs"></i> Set Area</button>`
                        }
                        <button class="btn btn-secondary" onclick="testMacro('${macro.id}')"><i class="fas fa-play"></i> Test</button>
                        <button class="btn btn-danger" onclick="removeMacro('${macro.id}')"><i class="fas fa-trash"></i> Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function updateStatistics(macros) {
            const totalMacros = macros.length;
            const readyMacros = macros.filter(m => m.area).length;

            document.getElementById('total-macros').textContent = totalMacros;
            document.getElementById('ready-macros').textContent = readyMacros;
        }

        function loadSettings() {
            const savePath = store.get('savePath', '');
            const autoSave = store.get('autoSave', true);
            document.getElementById('save-path').value = savePath;
            document.getElementById('auto-save').checked = autoSave;
        }

        function setupColorPresets() {
            document.querySelectorAll('.color-preset').forEach(preset => {
                preset.addEventListener('click', () => {
                    const color = preset.dataset.color;
                    document.getElementById('macro-color').value = color;
                    document.querySelectorAll('.color-preset').forEach(p => p.classList.remove('selected'));
                    preset.classList.add('selected');
                });
            });
        }

        function showAddMacroModal() {
            currentEditingMacro = null;
            document.getElementById('modal-title').textContent = 'Add New Macro';
            document.getElementById('macro-name').value = '';
            document.getElementById('macro-hotkey').value = '';
            document.getElementById('macro-color').value = '#4CAF50';
            document.getElementById('save-macro-btn').textContent = 'Save Macro';
            document.getElementById('save-macro-btn').disabled = true;
            document.getElementById('macroModal').style.display = 'block';

            document.querySelectorAll('.color-preset').forEach(p => p.classList.remove('selected'));
            document.querySelector('.color-preset[data-color="#4CAF50"]').classList.add('selected');
        }

        function editMacro(macroId) {
            const macros = store.get('macros', []);
            const macro = macros.find(m => m.id === macroId);

            if (!macro) return;

            currentEditingMacro = macro;
            document.getElementById('modal-title').textContent = 'Edit Macro';
            document.getElementById('macro-name').value = macro.name;
            document.getElementById('macro-hotkey').value = macro.hotkey;
            document.getElementById('macro-color').value = macro.color || '#4CAF50';
            document.getElementById('save-macro-btn').textContent = 'Update Macro';
            document.getElementById('save-macro-btn').disabled = false;
            document.getElementById('macroModal').style.display = 'block';

            document.querySelectorAll('.color-preset').forEach(p => p.classList.remove('selected'));
            const selectedPreset = document.querySelector(`[data-color="${macro.color || '#4CAF50'}"]`);
            if (selectedPreset) selectedPreset.classList.add('selected');
        }

        function hideMacroModal() {
            document.getElementById('macroModal').style.display = 'none';
            currentEditingMacro = null;
            detectingHotkey = false;
            document.getElementById('macro-hotkey').classList.remove('listening');
        }

        function saveMacro() {
            const name = document.getElementById('macro-name').value.trim();
            const hotkey = document.getElementById('macro-hotkey').value.trim();
            const color = document.getElementById('macro-color').value;

            if (!name || !hotkey) {
                alert('Please fill in both name and hotkey');
                return;
            }

            let macros = store.get('macros', []);

            if (currentEditingMacro) {
                const index = macros.findIndex(m => m.id === currentEditingMacro.id);
                if (index !== -1) {
                    const conflictingMacro = macros.find(m => m.hotkey === hotkey && m.id !== currentEditingMacro.id);
                    if (conflictingMacro) {
                        alert('Hotkey already exists! Please choose a different one.');
                        return;
                    }

                    macros[index] = {
                        ...macros[index],
                        name: name,
                        hotkey: hotkey,
                        color: color
                    };
                }
            } else {
                if (macros.some(m => m.hotkey === hotkey)) {
                    alert('Hotkey already exists! Please choose a different one.');
                    return;
                }

                const macro = {
                    id: Date.now().toString(),
                    name: name,
                    hotkey: hotkey,
                    color: color,
                    area: null
                };
                macros.push(macro);
            }

            store.set('macros', macros);
            hideMacroModal();
            loadMacros();
            ipcRenderer.send('refresh-hotkeys');
        }

        function setMacroArea(macroId) {
            store.set('currentMacroId', macroId);
            ipcRenderer.send('start-area-selection');
            window.close();
        }

        function testMacro(macroId) {
            const macros = store.get('macros', []);
            const macro = macros.find(m => m.id === macroId);
            if (!macro || !macro.area) {
                alert('Please set an area for this macro first');
                return;
            }
            ipcRenderer.send('test-capture', macroId);
        }

        function removeMacro(macroId) {
            if (confirm('Are you sure you want to delete this macro?')) {
                let macros = store.get('macros', []);
                macros = macros.filter(m => m.id !== macroId);
                store.set('macros', macros);
                loadMacros();
                ipcRenderer.send('refresh-hotkeys');
            }
        }

        function browseSavePath() {
            const { dialog } = require('electron').remote || require('@electron/remote');
            const result = dialog.showOpenDialogSync({
                properties: ['openDirectory']
            });
            if (result && result[0]) {
                document.getElementById('save-path').value = result[0];
                store.set('savePath', result[0]);
            }
        }

        function toggleAutoSave() {
            const autoSave = document.getElementById('auto-save').checked;
            store.set('autoSave', autoSave);
        }

        // Hotkey detection
        document.getElementById('macro-hotkey').addEventListener('click', function() {
            detectingHotkey = true;
            this.value = 'Listening... Press your key combination';
            this.classList.add('listening');
            document.getElementById('save-macro-btn').disabled = true;
        });

        document.addEventListener('keydown', function(event) {
            if (detectingHotkey) {
                event.preventDefault();
                event.stopPropagation();

                if (['Control', 'Shift', 'Alt', 'Meta', 'Cmd', 'Command'].includes(event.key)) {
                    return;
                }

                const modifierKeys = [];
                if (event.ctrlKey) modifierKeys.push('CommandOrControl');
                if (event.shiftKey) modifierKeys.push('Shift');
                if (event.altKey) modifierKeys.push('Alt');
                if (event.metaKey && !event.ctrlKey) modifierKeys.push('CommandOrControl');

                let actualKey = event.key;
                if (event.code.startsWith('Digit')) {
                    actualKey = event.code.replace('Digit', '');
                } else if (event.code.startsWith('Key')) {
                    actualKey = event.code.replace('Key', '');
                } else if (event.code.startsWith('F') && event.code.length <= 3) {
                    actualKey = event.code;
                }

                const hotkeyParts = [...modifierKeys, actualKey];
                const fullHotkey = hotkeyParts.join('+');

                if (modifierKeys.length > 0 && actualKey && actualKey !== 'Unidentified') {
                    document.getElementById('macro-hotkey').value = fullHotkey;
                    document.getElementById('macro-hotkey').classList.remove('listening');
                    document.getElementById('save-macro-btn').disabled = false;
                    detectingHotkey = false;
                } else {
                    document.getElementById('macro-hotkey').value = 'Invalid combination. Try again...';
                    setTimeout(() => {
                        document.getElementById('macro-hotkey').value = 'Listening... Press your key combination';
                    }, 1000);
                }
            }
        });

        // Modal event handlers
        window.onclick = function(event) {
            const modal = document.getElementById('macroModal');
            if (event.target == modal) {
                hideMacroModal();
            }
        }

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && !detectingHotkey) {
                hideMacroModal();
            }
        });

        // Listen for area selection completion
        ipcRenderer.on('area-assigned', (event) => {
            loadMacros();
        });

        document.addEventListener('click', function(event) {
            if (detectingHotkey && event.target.id !== 'macro-hotkey') {
                detectingHotkey = false;
                document.getElementById('macro-hotkey').value = '';
                document.getElementById('macro-hotkey').classList.remove('listening');
                document.getElementById('save-macro-btn').disabled = true;
            }
        });
    </script>
</body>
</html>
